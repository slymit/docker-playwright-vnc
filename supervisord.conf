[supervisord]
nodaemon=true
user=pwuser

[program:x]
command=Xvfb :1 -screen 0 1920x1080x24
autorestart=true
priority=10 # Start Xvfb first
user=pwuser
# HOME and USER env vars can be important for Xvnc finding .Xauthority if it tries to use it,
# or for other user-specific X configurations.
environment=HOME="/home/pwuser",USER="pwuser"

[program:vnc]
# Use a wrapper script to securely create a VNC password file and exec x11vnc
command=/home/pwuser/start-x11vnc.sh
autorestart=true
priority=20 # Start after Xvfb
user=pwuser
# HOME and USER env vars can be important for Xvnc finding .Xauthority if it tries to use it,
# or for other user-specific X configurations.
environment=HOME="/home/pwuser",USER="pwuser"

[program:novnc]
command=/opt/noVNC/utils/novnc_proxy --vnc localhost:5900 --listen 6900
autorestart=true
priority=25
user=pwuser
environment=HOME="/home/pwuser",USER="pwuser"

[program:fluxbox]
command=/usr/bin/fluxbox -display :1
autorestart=true
priority=30 # Start after x11vnc
environment=DISPLAY=":1"
user=pwuser

[program:playwright]
command=node /home/pwuser/start-playwright-server.js
autorestart=true
priority=40 # Start after fluxbox
environment=DISPLAY=":1" # Ensures Playwright uses the VNC display
user=pwuser
# # Add these for better logging of the Node.js script
# stdout_logfile=/var/log/supervisor/playwright_stdout.log
# stderr_logfile=/var/log/supervisor/playwright_stderr.log